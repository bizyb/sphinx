{% extends 'base.html' %}

{% block content %}
<script type="text/javascript">
	
	var failIcon = '&#10007;'; // x
	var passIcon = '&#10003;'; // checkmark
	var passwordValidated = false;
	var inviteValidated = false;
	var usernameValidated = false;

	function successIcon(elemID, icon, status) {
		
		if (status == "success") document.getElementById(elemID).style.color = "green";
	
		else  if (status == "fail") document.getElementById(elemID).style.color = "red";

		document.getElementById(elemID).innerHTML = icon;
	}

	function ajaxValidation(valueType, value, elemID) {
		var validated = false;
		if (value != "") {
			var url;
			var csrftoken = Cookies.get('csrftoken');
			postData = {valueType: value};

			if (valueType == "username") url = "username-availability";
			else if (valueType == "invite_code") url = "invite-code-validation";


			var xmlhttp = new XMLHttpRequest();
	   		xmlhttp.open("POST", url, true);
	   		xmlhttp.setRequestHeader("X-CSRFToken", csrftoken);
	   		xmlhttp.send(postData);

	   		xmlhttp.onreadystatechange = function() {
			    if (this.readyState == 4 && this.status == 200) {
			        var jsonObj = JSON.parse(this.responseText);
			        if (jsonObj.status == 'SUCCESS') {
			        	successIcon(elemID, passIcon, "success");
			        	validated = true;
			        }
			        else {
			        	successIcon(elemID, failIcon, "fail");
			        	validated = false;
			        }
			    }
			};
   		}

   		else {
   			successIcon(elemID, "", "reset");
   			validated = false;
   		}
   		return validated;
	}

	function usernameExists(input) {

		ajaxValidation("username", input.value, "username-exists");
	}

	function validateInvite(input) {

		var success = ajaxValidation("invite_code", input.value, "invite-is-valid");
		console.log(success);
	}

	function loadForm(formID) {

		if (formID == "signup") {
			document.getElementById("signup").style.display = "block"
			document.getElementById("login").style.display = "none"
		}
		else if (formID == "login") {
			document.getElementById("signup").style.display = "none"
			document.getElementById("login").style.display = "block"
		}

	}

	function patternMatch(string) {

		var pattern = /^(\w+){8,}$/; //at least eight characters and alphanumeric
		matchArr =  string.match(pattern);
		if (matchArr != null && matchArr.length > 0) return true;
		return false;

	}

	function passwordMatch() {
	
		var password1 = document.getElementById('password1').value;
		var password2 = document.getElementById('password2').value;

		if (password1 != "" && password1 == password2 && patternMatch(password1)) {
			successIcon('password-match', passIcon, "success"); }

		else if ((password2 != "" && password1 != password2) || 
			(password2 != "" && !patternMatch(password1))) successIcon('password-match', failIcon, "fail");
		else successIcon('password-match', "", "reset");
	}

	// function disableButton() {

	// 	document.getElementById('signup-button').style.display = "none";

	// }

	// function formSubmit() {

	// 	if (passwordValidated && inviteValidated && usernameValidated) {
	// 		// submit form
	// 	}

	// }
</script>
<div class="login-page">
  <div class="form">
  	<div id="signup">
    <form class="register-form" action="" method="post">
 		{% csrf_token %}
      <input type="text" name="first_name" placeholder="First Name" required/>
      <input type="text" name="last_name" placeholder="Last Name" required/>
     <div> <input type="text" name="username" placeholder="Username" required on 
      		onkeyup="usernameExists(this)"/><div class="username-exists-box" id="username-exists"></div></div>
      <input type="email" name="email" placeholder="Email" required/>


      <div class="message" id="password-requirements">
      	Password must be at least 8 characters long and may contain numbers, letters, and underscores
      	<input type="password" placeholder="Create a password" name="password1" required
      	id="password1" onkeyup="passwordMatch()"/></div>
      <div><input type="password" placeholder="Confirm your password" name="password2" required id="password2" onkeyup="passwordMatch()"/>
      <div class="password-match-box" id="password-match"></div></div>

      <div class="team-dropdown">Team
      <select name="team_name" id="team">
      	<option value="3d">3D</option>
          <option value="android">Android</option>
          <option value="backend">Backend</option>
          <option value="frontend">Frontend</option>
          <option value="ios">iOS</option>
          <option value="ml">ML</option>
       </select>
   </div>
       <div><input type="text" name="invite_code" placeholder="Invite code" required onkeyup="validateInvite(this)"/><div class="invite-validation-box" id="invite-is-valid"></div></div>

      <button id="signup-button" onclick="formSubmit()">Register</button>

      <p class="message" onclick="loadForm('login')">Already registered? <a href="#">Sign In</a></p>
    </form>
</div>
<div id="login">
    <form class="login-form" action="" method="post">
    	{% csrf_token %}
      <input type="text" placeholder="username"/>
      <input type="password" placeholder="password"/>
      <button>login</button>
      <p class="message" onclick="loadForm('signup')">Not registered? <a >Create an account</a></p>
      <p class="message"> Coming Soon: <a>Forgot password?</a></p>
    </form>
</div>
  </div>
</div>
{% endblock %}